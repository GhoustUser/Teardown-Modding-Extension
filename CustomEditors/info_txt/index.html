<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>info.txt</title>
</head>

<body>
    <label for="name_field">Name:</label>
    <input id="name_field" type="text" style="width: 100%;" />

    <label for="author_field">Author:</label>
    <input id="author_field" type="text" style="width: 100%;" />

    <label for="description_field">Description:</label>
    <textarea id="description_field" style="width: 100%; height: 20%;"></textarea>

    <label for="tags_field">Tags:</label>
    <input id="tags_field" type="text" style="width: 100%;" />

    <label for="version_field">Version:</label>
    <input id="version_field" type="text" style="width: 100%;" />

    <button id="saveButton">Save</button>

    <script>
        const vscode = acquireVsCodeApi();

        // Function to parse the content into fields
        function parseContent(content) {
            const lines = content.split('\n');
            const fields = { name: '', author: '', description: '', tags: '', version: '' };
            let currentField = null;

            lines.forEach(line => {
                if (line.startsWith('name = ')) {
                    fields.name = line.replace('name = ', '').trim();
                } else if (line.startsWith('author = ')) {
                    fields.author = line.replace('author = ', '').trim();
                } else if (line.startsWith('description = ')) {
                    fields.description = line.replace('description = ', '').trim();
                    currentField = 'description';
                } else if (line.startsWith('tags = ')) {
                    fields.tags = line.replace('tags = ', '').trim();
                    currentField = null;
                } else if (line.startsWith('version = ')) {
                    fields.version = line.replace('version = ', '').trim();
                    currentField = null;
                } else if (currentField === 'description') {
                    fields.description += '\n' + line.trim();
                }
            });

            return fields;
        }

        // Function to merge fields into content
        function mergeContent(fields) {
            let content = '';
            if (fields.name) content += `name = ${fields.name}\n`;
            if (fields.author) content += `author = ${fields.author}\n`;
            if (fields.description) content += `description = ${fields.description}\n`;
            if (fields.tags) content += `tags = ${fields.tags}\n`;
            if (fields.version) content += `version = ${fields.version}\n`;
            return content.trim();
        }

        // Handle the save button click
        document.getElementById('saveButton').addEventListener('click', () => {
            const fields = {
                name: document.getElementById('name_field').value,
                author: document.getElementById('author_field').value,
                description: document.getElementById('description_field').value,
                tags: document.getElementById('tags_field').value,
                version: document.getElementById('version_field').value
            };

            const saveString = mergeContent(fields);

            vscode.postMessage({
                type: 'edit',
                text: saveString
            });
        });

        // Listen for messages from the extension
        window.addEventListener('message', (event) => {
            const message = event.data;
            if (message.type === 'update') {
                const fields = parseContent(message.text);
                document.getElementById('name_field').value = fields.name;
                document.getElementById('author_field').value = fields.author;
                document.getElementById('description_field').value = fields.description;
                document.getElementById('tags_field').value = fields.tags;
                document.getElementById('version_field').value = fields.version;
            }
        });
    </script>
</body>

</html>